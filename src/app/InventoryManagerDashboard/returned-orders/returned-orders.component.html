<div class="max-w-6xl mx-auto mt-10 p-6 bg-white shadow-xl rounded-xl">
  <h2 class="text-2xl font-bold text-center text-blue-800 mb-8">
    🔄 Returned Orders
  </h2>

  <!-- Loader -->
  <div *ngIf="loading" class="text-center text-gray-500">Loading...</div>

  <!-- Error -->
  <div *ngIf="error" class="text-center text-red-600">{{ error }}</div>

  <!-- Filters -->
  <div class="bg-blue-50 p-4 rounded-lg shadow mb-6">
    <h3 class="font-semibold text-blue-800 mb-3">🔍 Filter Returned Orders</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <input
        type="number"
        placeholder="Return ID"
        [(ngModel)]="filters.returnId"
        class="border rounded p-2 w-full"
      />
      <input
        type="date"
        [(ngModel)]="filters.rdate"
        class="border rounded p-2 w-full"
      />
      <input
        type="number"
        placeholder="Purchase Order ID"
        [(ngModel)]="filters.purchaseOrderId"
        class="border rounded p-2 w-full"
      />
    </div>
    <div class="mt-3 flex gap-2">
      <button
        (click)="applyFilters()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
      >
        Apply
      </button>
      <button
        (click)="resetFilters()"
        class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded"
      >
        Reset
      </button>
    </div>
  </div>

  <!-- Table -->
  <div *ngIf="!loading && returnedOrders.length > 0" class="overflow-x-auto">
    <table
      class="min-w-max table-auto border border-gray-200 shadow-lg rounded-lg overflow-hidden"
    >
      <thead class="bg-blue-100 text-blue-900 text-sm uppercase font-semibold">
        <tr>
          <th class="px-4 py-3 border">Return ID</th>
          <th class="px-4 py-3 border">Order ID</th>
          <th class="px-4 py-3 border">Return Date</th>
          <th class="px-4 py-3 border">Reason</th>
          <th class="px-4 py-3 border">Status</th>
          <th class="px-4 py-3 border">Returned By</th>
          <th class="px-4 py-3 border">Items</th>
          <th class="px-4 py-3 border">Actions</th>
        </tr>
      </thead>
      <tbody class="text-sm text-gray-700">
        <tr
          *ngFor="let order of returnedOrders"
          class="hover:bg-gray-100 transition duration-200"
        >
          <td class="border px-4 py-2 text-center font-medium text-gray-800">
            {{ order.rid }}
          </td>
          <td class="border px-4 py-2 text-center">
            {{ order.purchaseOrder?.purchaseOrderId }}
          </td>
          <td class="border px-4 py-2 text-center">
            {{ order.rdate | date }}
          </td>
          <td class="border px-4 py-2 text-center">
            {{ order.rreason }}
          </td>
          <td
            class="border px-4 py-2 text-center font-semibold"
            [ngClass]="{
              'text-red-600': order.rstatus === 'REJECTED',
              'text-green-600': order.rstatus === 'APPROVED',
              'text-yellow-600': order.rstatus === 'PENDING'
            }"
          >
            {{ order.rstatus }}
          </td>
          <td class="border px-4 py-2 text-center">
            {{ order.returnedBy?.username || "N/A" }}
          </td>
          <td class="border px-4 py-2">
            <div *ngIf="order.items?.length; else noItems">
              <ul class="list-disc list-inside text-left">
                <li *ngFor="let item of order.items">
                  {{ item.product?.productName }} (x{{ item.returnQuantity }})
                </li>
              </ul>
            </div>
            <ng-template #noItems> - </ng-template>
          </td>
          <td class="border px-4 py-2 text-center">
            <!-- If approved, show badge -->
            <span
              *ngIf="order.rstatus === 'APPROVED'; else approveBtn"
              class="px-3 py-1 rounded-full text-xs font-semibold text-green-800 bg-green-200 border border-green-400"
            >
              ✅ Approved
            </span>

            <!-- Else show button -->
            <ng-template #approveBtn>
              <button
                class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded transition duration-200"
                (click)="approveOrder(order.rid)"
              >
                Approve
              </button>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Data -->
  <div
    *ngIf="!loading && returnedOrders.length === 0"
    class="text-center text-gray-500"
  >
    No returned orders found.
  </div>
</div>
