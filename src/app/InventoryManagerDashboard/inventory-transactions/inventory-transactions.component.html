<!-- inventory-transactions.component.html -->
<div
  class="p-8 bg-gradient-to-br from-gray-50 via-white to-gray-100 rounded-3xl shadow-2xl max-w-7xl mx-auto mt-10 border border-gray-200"
>
  <!-- Header -->
  <div
    class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4"
  >
    <div class="flex items-center gap-3">
      <div class="p-3 rounded-xl bg-indigo-100 text-indigo-600 shadow-md">
        <svg
          class="w-7 h-7"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 10h11M9 21V3m12 9h-4m0 0V7m0 5v4"
          />
        </svg>
      </div>
      <h2 class="text-3xl font-bold text-gray-800">Inventory Transactions</h2>
    </div>
    <span
      class="px-4 py-1.5 rounded-full bg-gray-200 text-gray-600 text-sm font-semibold shadow-sm"
    >
      Total Transactions: {{ transactions.length }}
    </span>
  </div>

  <!-- Loading -->
  <div
    *ngIf="isLoading"
    class="text-indigo-600 text-center font-medium mb-6 animate-pulse"
  >
    Fetching transactions...
  </div>

  <!-- Filters Section -->
  <div
    class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6"
    [formGroup]="filtersForm"
  >
    <input
      type="text"
      formControlName="productName"
      placeholder="🔍 Search Product"
      class="border rounded-lg px-3 py-2 shadow-sm w-full"
    />

    <select
      formControlName="transactionType"
      class="border rounded-lg px-3 py-2 shadow-sm w-full"
    >
      <option value="">All Types</option>
      <option value="IN">IN</option>
      <option value="OUT">OUT</option>
    </select>

    <input
      type="date"
      formControlName="startDate"
      class="border rounded-lg px-3 py-2 shadow-sm w-full"
    />
    <input
      type="date"
      formControlName="endDate"
      class="border rounded-lg px-3 py-2 shadow-sm w-full"
    />

    <input
      type="text"
      formControlName="performedBy"
      placeholder="👤 Performed By"
      class="border rounded-lg px-3 py-2 shadow-sm w-full"
    />
  </div>

  <!-- Filter Buttons -->
  <div class="flex flex-wrap gap-4 mb-8">
    <button
      (click)="clearFilters()"
      class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg shadow hover:bg-gray-300 transition"
    >
      Clear Filters
    </button>

    <button
      (click)="exportPdf()"
      class="bg-red-500 text-white px-4 py-2 rounded-lg shadow hover:bg-red-600 transition flex items-center gap-2"
      title="Download transactions as PDF"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 4v16m8-8H4"
        />
      </svg>
      Export PDF
    </button>

    <button
      (click)="exportExcel()"
      class="bg-green-500 text-white px-4 py-2 rounded-lg shadow hover:bg-green-600 transition flex items-center gap-2"
      title="Download transactions as Excel"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M4 4h16v16H4z"
        />
      </svg>
      Export Excel
    </button>
  </div>

  <!-- Empty -->
  <div
    *ngIf="!isLoading && transactions.length === 0"
    class="text-center py-20 text-gray-500"
  >
    <svg
      class="w-24 h-24 mx-auto mb-6 text-gray-400"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0H4m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5"
      />
    </svg>
    <p class="text-lg font-semibold">No transactions yet</p>
    <p class="text-sm text-gray-400">
      All stock movements will appear here once logged.
    </p>
  </div>

  <!-- Transactions Table -->
  <div
    *ngIf="!isLoading && transactions.length > 0"
    class="overflow-hidden rounded-2xl border border-gray-200 shadow-md"
  >
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead
          class="bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 text-xs uppercase tracking-wider sticky top-0 shadow-sm z-10"
        >
          <tr>
            <th class="px-6 py-4 text-left">#</th>
            <th class="px-6 py-4 text-left">Product</th>
            <th class="px-6 py-4 text-center">Quantity</th>
            <th class="px-6 py-4 text-center">Type</th>
            <th class="px-6 py-4 text-center">Date</th>
            <th class="px-6 py-4 text-left">Reference</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <!-- <tr
            *ngFor="let tx of transactions; let i = index"
            class="hover:bg-indigo-50/50 transition-all duration-200 ease-in-out"
          > -->
          <tr
            *ngFor="let tx of transactions; let i = index"
            class="hover:bg-indigo-50/50 transition-all duration-200 ease-in-out cursor-pointer"
            (click)="openModal(tx)"
          >
            <td class="px-6 py-4 font-semibold text-gray-800">
              {{ i + 1 }}
            </td>
            <td class="px-6 py-4 text-gray-700">
              {{ tx.product?.productName || "—" }}
            </td>
            <td class="px-6 py-4 text-center font-bold text-gray-900">
              {{ tx.quantity }}
            </td>
            <td class="px-6 py-4 text-center">
              <span
                class="px-3 py-1.5 text-xs font-semibold rounded-full shadow-sm"
                [ngClass]="{
                  'bg-green-100 text-green-700 border border-green-200':
                    tx.transactionType === 'DELIVER',
                  'bg-red-100 text-red-700 border border-red-200':
                    tx.transactionType === 'CONSUME',
                  'bg-blue-100 text-blue-700 border border-blue-200':
                    tx.transactionType === 'ADD'
                }"
              >
                {{ tx.transactionType }}
              </span>
            </td>
            <td
              class="px-6 py-4 text-center text-gray-600 flex items-center justify-center gap-2"
            >
              <svg
                class="w-4 h-4 text-gray-400"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M8 7V3m8 4V3M4 11h16M4 19h16M4 15h16"
                />
              </svg>
              {{ tx.transactionDate | date : "mediumDate" }}
            </td>
            <td class="px-6 py-4 text-gray-600 italic">
              {{ tx.reference || "—" }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- Transaction Modal -->
<!-- Transaction Modal -->
<div
  *ngIf="showModal"
  class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"
>
  <div
    class="bg-white/95 rounded-3xl shadow-2xl max-w-3xl w-full mx-4 overflow-hidden transform transition-all duration-300 scale-95 animate-fadeInUp"
  >
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 flex justify-between items-center">
      <h3 class="text-lg font-semibold">Transaction Details</h3>
      <button
        class="text-white hover:text-gray-200 transition"
        (click)="closeModal()"
      >
        ✕
      </button>
    </div>

    <!-- Body -->
    <div class="p-6 max-h-[80vh] overflow-y-auto text-gray-700">
      <div *ngIf="selectedTransaction">
        <!-- Transaction Info -->
        <div class="mb-6">
          <h4 class="text-xl font-bold mb-2 text-gray-800">📑 Transaction Info</h4>
          <div class="grid grid-cols-2 gap-4">
            <p><strong>ID:</strong> {{ selectedTransaction.transactionId }}</p>
            <p><strong>Date:</strong> {{ selectedTransaction.transactionDate | date }}</p>
            <p><strong>Type:</strong> {{ selectedTransaction.transactionType }}</p>
            <p><strong>Quantity:</strong> {{ selectedTransaction.quantity }}</p>
            <p class="col-span-2"><strong>Reference:</strong> {{ selectedTransaction.reference }}</p>
          </div>
        </div>

        <!-- Product Info -->
        <div class="mb-6 border-t pt-4">
          <h4 class="text-xl font-bold mb-2 text-gray-800">📦 Product Info</h4>
          <div class="grid grid-cols-2 gap-4">
            <p><strong>Name:</strong> {{ selectedTransaction.product?.productName }}</p>
            <p><strong>Description:</strong> {{ selectedTransaction.product?.productDescription }}</p>
            <p><strong>Category:</strong> {{ selectedTransaction.product?.category?.categoryName }}</p>
            <p><strong>Price:</strong> {{ selectedTransaction.product?.productUnitPrice | currency }}</p>
            <p><strong>Available Qty:</strong> {{ selectedTransaction.product?.productQuantity }}</p>
          </div>
        </div>

        <!-- User Info -->
        <div class="mb-6 border-t pt-4">
          <h4 class="text-xl font-bold mb-2 text-gray-800">👤 Performed By</h4>
          <div class="grid grid-cols-2 gap-4">
            <p><strong>User:</strong> {{ selectedTransaction.userId?.username }}</p>
            <p><strong>Email:</strong> {{ selectedTransaction.userId?.email }}</p>
            <p><strong>Role:</strong> {{ selectedTransaction.userId?.role?.roleName }}</p>
            <p><strong>Phone:</strong> {{ selectedTransaction.userId?.phoneno }}</p>
            <p class="col-span-2">
              <strong>Address:</strong>
              {{ selectedTransaction.userId?.address?.addressStreet }},
              {{ selectedTransaction.userId?.address?.addressCity }},
              {{ selectedTransaction.userId?.address?.addressState }},
              {{ selectedTransaction.userId?.address?.addressPostalCode }},
              {{ selectedTransaction.userId?.address?.addressCountry }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
