<div class="flex items-center justify-center min-h-screen bg-gradient-to-tr from-blue-100 to-indigo-200">
  <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-sm animate-fade-in transition-all duration-300">
    <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700">Reset Password</h2>

    <form #resetForm="ngForm" (ngSubmit)="resetPassword()">
      <!-- Username -->
      <div class="mb-4 relative">
        <label for="username" class="block text-sm font-medium mb-1">Username</label>
        <div class="relative">
          <i class="fas fa-user absolute left-3 top-3.5 text-gray-400 text-sm"></i>
          <input
            [(ngModel)]="username"
            name="username"
            id="username"
            required
            #usernameInput="ngModel"
            class="w-full pl-10 border border-gray-300 px-4 py-2 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
          />
        </div>
        <div *ngIf="usernameInput.invalid && usernameInput.touched" class="text-red-500 text-sm mt-1">
          Username is required.
        </div>
      </div>

      <!-- OTP Send & Field -->
      <div class="mb-4">
        <button
          type="button"
          (click)="sendOtp()"
          class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition duration-200"
        >
          <i class="fas fa-envelope mr-2"></i> Send OTP
        </button>
      </div>

      <div *ngIf="otpSent" class="mb-4 relative">
        <label for="otp" class="block text-sm font-medium mb-1">Enter OTP</label>
        <div class="relative">
          <i class="fas fa-key absolute left-3 top-3.5 text-gray-400 text-sm"></i>
          <input
            [(ngModel)]="otp"
            name="otp"
            id="otp"
            required
            class="w-full pl-10 border border-gray-300 px-4 py-2 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
          />
        </div>
      </div>

      <!-- New Password -->
      <div *ngIf="otpSent" class="mb-4 relative">
        <label for="newPassword" class="block text-sm font-medium mb-1">New Password</label>
        <div class="relative">
          <i class="fas fa-lock absolute left-3 top-3.5 text-gray-400 text-sm"></i>
          <input
            [(ngModel)]="newPassword"
            name="newPassword"
            id="newPassword"
            [type]="showNewPassword ? 'text' : 'password'"
            required
            pattern="^(?=.*[A-Z])(?=.*\d).{8,}$"
            #newPasswordInput="ngModel"
            class="w-full pl-10 pr-10 border border-gray-300 px-4 py-2 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
          />
          <i
            class="fas absolute right-3 top-3.5 text-gray-500 cursor-pointer"
            [class.fa-eye-slash]="showNewPassword"
            [class.fa-eye]="!showNewPassword"
            (click)="showNewPassword = !showNewPassword"
          ></i>
        </div>
        <div *ngIf="newPasswordInput.invalid && newPasswordInput.touched" class="text-red-500 text-sm mt-1">
          <div *ngIf="newPasswordInput.errors?.['required']">New password is required.</div>
          <div *ngIf="newPasswordInput.errors?.['pattern']">
            Password must be at least 8 characters, include 1 uppercase letter and 1 digit.
          </div>
        </div>
      </div>

      <!-- Confirm Password -->
      <div *ngIf="otpSent" class="mb-4 relative">
        <label for="confirmPassword" class="block text-sm font-medium mb-1">Confirm Password</label>
        <div class="relative">
          <i class="fas fa-lock absolute left-3 top-3.5 text-gray-400 text-sm"></i>
          <input
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            required
            pattern="^(?=.*[A-Z])(?=.*\d).{8,}$"
            #confirmPasswordInput="ngModel"
            class="w-full pl-10 pr-10 border border-gray-300 px-4 py-2 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
          />
          <i
            class="fas absolute right-3 top-3.5 text-gray-500 cursor-pointer"
            [class.fa-eye-slash]="showConfirmPassword"
            [class.fa-eye]="!showConfirmPassword"
            (click)="showConfirmPassword = !showConfirmPassword"
          ></i>
        </div>
        <div *ngIf="confirmPasswordInput.touched && confirmPassword !== newPassword" class="text-red-500 text-sm mt-1">
          Passwords do not match.
        </div>
      </div>

      <!-- Submit Button -->
      <button
        *ngIf="otpSent"
        type="submit"
        [disabled]="resetForm.invalid || confirmPassword !== newPassword"
        class="cursor-pointer w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <i class="fas fa-sync-alt mr-2"></i> Reset Password
      </button>

      <!-- Success & Error Messages -->
      <div *ngIf="message" class="text-green-600 mt-3 text-center">{{ message }}</div>
      <div *ngIf="errorMessage" class="text-red-600 mt-3 text-center">{{ errorMessage }}</div>
    </form>

    <!-- Back to Login -->
    <div class="text-center mt-4">
      <button
        type="button"
        (click)="goToLogin()"
        class="cursor-pointer hover:underline text-sm font-medium"
      >
        <i class="fas fa-arrow-left mr-1"></i> Back to Login
      </button>
    </div>
  </div>
</div>
