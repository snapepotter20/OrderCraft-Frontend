<div *ngIf="open" class="fixed inset-0 bg-black bg-opacity-30 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative">
    <button (click)="handleClose()" class="absolute top-2 right-3 text-2xl font-bold">&times;</button>
    <h2 class="text-xl font-semibold mb-4">
      Return Items from Order #{{ order?.purchaseOrderId }}
    </h2>
    <form [formGroup]="returnForm" (ngSubmit)="handleSubmit()">
      <div *ngFor="let item of order?.items; let i = index" class="mb-4 border-b pb-4">
        <label class="flex items-center gap-2">
          <input type="checkbox" [formControlName]="'return_'+i+'_checked'" />
          {{ item.product.productName }} (Ordered: {{ item.quantity }})
        </label>
        <div *ngIf="returnForm.get('return_'+i+'_checked')?.value" class="mt-2">
          <label class="text-sm font-medium">Return Quantity:</label>
          <input type="number" min="1" [max]="item.quantity"
                 [formControlName]="'return_'+i+'_qty'"
                 class="w-24 border px-2 py-1 ml-2 rounded"/>
          <span class="text-xs text-gray-500 ml-1">
            (max: {{ item.quantity }})
          </span>
        </div>
      </div>
      <div class="mb-4">
        <label class="block font-medium mb-1">Reason for Return</label>
        <textarea formControlName="reason"
          class="w-full border p-2 rounded"
          required rows="3"></textarea>
      </div>
      <div class="flex justify-end gap-2">
        <button type="button" (click)="handleClose()" class="px-4 py-2 bg-gray-500 text-white rounded">
          Cancel
        </button>
        <button type="submit" [disabled]="returnForm.invalid || !hasReturnItems()" class="px-6 py-2 bg-purple-700 text-white rounded hover:bg-purple-800">
          Submit Return Request
        </button>
      </div>
    </form>
  </div>
</div>
