<div class="p-6 bg-white shadow-xl rounded-2xl">
  <h2
    class="text-xl font-bold mb-4 text-gray-800 flex justify-between items-center"
  >
    Manage Suppliers
    <button
      (click)="toggleForm()"
      class="flex items-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-medium px-4 py-2 rounded-full shadow-md hover:from-blue-600 hover:to-blue-700 hover:shadow-lg transition-all duration-200 ease-in-out"
    >
      <i *ngIf="showForm" class="fa-solid fa-xmark text-white"></i>
      <i *ngIf="!showForm" class="fa-solid fa-plus text-white"></i>
      {{ showForm ? "Cancel" : "Create Supplier" }}
    </button>
  </h2>

  <!-- Create / Edit Supplier Form -->
  <div
    *ngIf="showForm"
    class="mb-6 p-4 border rounded-lg bg-gray-50 shadow-inner"
  >
    <h3 class="text-lg font-semibold mb-4 text-gray-700">
      <i
        [ngClass]="
          isEditMode
            ? 'fa-solid fa-pen-to-square text-blue-600'
            : 'fa-solid fa-user-plus text-green-600'
        "
        class="mr-2"
      ></i>
      {{ isEditMode ? "Edit Supplier" : "Supplier Details" }}
    </h3>

    <div class="grid grid-cols-2 gap-4">
      <input
        type="text"
        [(ngModel)]="newSupplier.supplier_name"
        placeholder="Supplier Name"
        [ngClass]="getInputClass('supplier_name')"
      />
      <input
        type="text"
        [(ngModel)]="newSupplier.contact_name"
        placeholder="Contact Name"
        [ngClass]="getInputClass('contact_name')"
      />
      <input
        type="email"
        [(ngModel)]="newSupplier.contact_email"
        placeholder="Contact Email"
        [ngClass]="getInputClass('contact_email')"
      />
      <input
        type="text"
        [(ngModel)]="newSupplier.phone"
        placeholder="Phone"
        [ngClass]="getInputClass('phone')"
      />

      <input
        type="text"
        [(ngModel)]="newSupplier.address.addressStreet"
        placeholder="Street"
        [ngClass]="getInputClass('street')"
        class="col-span-2"
      />
      <input
        type="text"
        [(ngModel)]="newSupplier.address.addressCity"
        placeholder="City"
        [ngClass]="getInputClass('city')"
      />
      <input
        type="text"
        [(ngModel)]="newSupplier.address.addressState"
        placeholder="State"
        [ngClass]="getInputClass('state')"
      />
    </div>

    <!-- Rating -->
    <div class="col-span-2 mt-4">
      <label class="block text-gray-700 font-medium mb-1">Rating</label>
      <div class="flex gap-1">
        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
          <i
            (click)="newSupplier.rating = star"
            class="fa-solid fa-star text-3xl cursor-pointer transition"
            [ngClass]="
              star <= newSupplier.rating
                ? 'text-yellow-500'
                : 'text-gray-300 hover:text-yellow-400'
            "
          ></i>
        </ng-container>
      </div>
    </div>

    <button
      (click)="saveSupplier()"
      class="mt-6 bg-green-600 text-white px-5 py-2 rounded-lg shadow hover:bg-green-700 transition flex items-center gap-2"
    >
      <i
        [ngClass]="
          isEditMode ? 'fa-solid fa-pen-to-square' : 'fa-solid fa-check'
        "
      ></i>
      {{ isEditMode ? "Update Supplier" : "Save Supplier" }}
    </button>
  </div>

  <!-- Filters Section -->
  <div
    class="p-5 mb-6 rounded-2xl bg-white/70 backdrop-blur-md shadow-xl border border-gray-200"
  >
    <h3
      class="text-lg font-semibold mb-4 text-gray-700 flex items-center gap-2"
    >
      <i class="fa-solid fa-filter text-blue-600"></i>
      Filter Suppliers
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
      <!-- Filter Input -->
      <div class="relative">
        <i class="fa-solid fa-user text-gray-400 absolute left-3 top-3"></i>
        <input
          type="text"
          placeholder="Supplier Name"
          [(ngModel)]="filters.supplier_name"
          (input)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:bg-white transition"
        />
      </div>

      <div class="relative">
        <i
          class="fa-solid fa-address-book text-gray-400 absolute left-3 top-3"
        ></i>
        <input
          type="text"
          placeholder="Contact Name"
          [(ngModel)]="filters.contact_name"
          (input)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:bg-white transition"
        />
      </div>

      <div class="relative">
        <i class="fa-solid fa-envelope text-gray-400 absolute left-3 top-3"></i>
        <input
          type="email"
          placeholder="Email"
          [(ngModel)]="filters.contact_email"
          (input)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:bg-white transition"
        />
      </div>

      <div class="relative">
        <i class="fa-solid fa-phone text-gray-400 absolute left-3 top-3"></i>
        <input
          type="text"
          placeholder="Phone"
          [(ngModel)]="filters.phone"
          (input)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:bg-white transition"
        />
      </div>

      <div class="relative">
        <i class="fa-solid fa-city text-gray-400 absolute left-3 top-3"></i>
        <input
          type="text"
          placeholder="City"
          [(ngModel)]="filters.city"
          (input)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:bg-white transition"
        />
      </div>

      <div class="relative">
        <i
          class="fa-solid fa-location-dot text-gray-400 absolute left-3 top-3"
        ></i>
        <input
          type="text"
          placeholder="State"
          [(ngModel)]="filters.state"
          (input)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 focus:bg-white transition"
        />
      </div>

      <!-- Rating Dropdown -->
      <div class="relative">
        <i class="fa-solid fa-star text-yellow-500 absolute left-3 top-3"></i>
        <select
          [(ngModel)]="filters.rating"
          (change)="applyFilters()"
          class="pl-10 w-full p-2 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 bg-white transition cursor-pointer"
        >
          <option value="">Rating (All)</option>
          <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">
            {{ r }} Stars
          </option>
        </select>
      </div>

      <!-- Clear Button -->
      <button
        (click)="resetFilters()"
        class="bg-red-500 col-span-1 md:col-span-3 lg:col-span-1 text-white py-2 px-4 rounded-xl shadow hover:bg-red-600 transition flex items-center justify-center gap-2"
      >
        <i class="fa-solid fa-circle-xmark"></i> Clear Filters
      </button>
    </div>
  </div>

  <!-- Supplier List -->
  <div *ngIf="loading" class="text-blue-600 flex items-center gap-2">
    <i class="fa-solid fa-spinner fa-spin"></i> Loading suppliers...
  </div>
  <div *ngIf="error" class="text-red-600 flex items-center gap-2">
    <i class="fa-solid fa-circle-exclamation"></i> {{ error }}
  </div>

  <div class="overflow-x-auto rounded-lg shadow">
    <table
      *ngIf="!loading && suppliers.length > 0"
      class="w-full border-collapse"
    >
      <thead class="bg-gradient-to-r from-blue-600 to-blue-800 text-white">
        <tr>
          <th class="p-3 text-left">ID</th>
          <th class="p-3 text-left">Name</th>
          <th class="p-3 text-left">Contact</th>
          <th class="p-3 text-left">Email</th>
          <th class="p-3 text-left">Phone</th>
          <th class="p-3 text-left">Address</th>
          <th class="p-2 border">Rating</th>
          <th class="p-3 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let s of filteredSuppliers"
          class="odd:bg-gray-50 even:bg-white hover:bg-blue-50 transition"
        >
          <td class="p-3 text-gray-700">{{ s.supplier_id }}</td>
          <td class="p-3 font-medium text-gray-900">{{ s.supplier_name }}</td>
          <td class="p-3 text-gray-700">{{ s.contact_name }}</td>
          <td class="p-3 text-gray-700">{{ s.contact_email }}</td>
          <td class="p-3 text-gray-700">{{ s.phone }}</td>
          <td class="p-3 text-gray-700">
            {{ s.address?.addressStreet }}, {{ s.address?.addressCity }},
            {{ s.address?.addressState }}
          </td>
          <td class="p-2 border">
            <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
              <i
                class="fa-solid fa-star"
                [ngClass]="
                  star <= s.rating ? 'text-yellow-500' : 'text-gray-300'
                "
              ></i>
            </ng-container>
          </td>
          <td class="p-2 border">
            <div class="flex items-center gap-2">
              <button
                class="bg-yellow-500 text-white px-3 py-1 rounded-md shadow hover:bg-yellow-600 transition flex items-center gap-1"
                (click)="editSupplier(s)"
              >
                <i class="fa-solid fa-pen"></i> Edit
              </button>
              <button
                class="bg-red-600 text-white px-3 py-1 rounded-md shadow hover:bg-red-700 transition flex items-center gap-1"
                (click)="deleteSupplier(s.supplier_id)"
              >
                <i class="fa-solid fa-trash"></i> Delete
              </button>

              <!-- Upload / Download -->
              <button
                *ngIf="!s.contractFile"
                class="bg-blue-600 text-white px-3 py-1 rounded-md shadow hover:bg-blue-700 transition flex items-center gap-1"
                (click)="onUploadContract(s.supplier_id)"
              >
                <i class="fa-solid fa-upload"></i> Upload Contract
              </button>
              <button
                *ngIf="s.contractFile"
                class="bg-green-600 text-white px-3 py-1 rounded-md shadow hover:bg-green-700 transition flex items-center gap-1"
                (click)="onDownloadContract(s.supplier_id)"
              >
                <i class="fa-solid fa-download"></i> Download Contract
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    *ngIf="!loading && suppliers.length === 0"
    class="text-gray-600 mt-4 text-center flex justify-center items-center gap-2"
  >
    <i class="fa-solid fa-ban text-red-500"></i> No suppliers found.
  </div>
</div>
