<div
  class="max-w-6xl mx-auto mt-8 p-8 bg-white rounded-3xl shadow-xl border border-gray-100"
>
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h2
        class="text-3xl font-extrabold text-blue-900 tracking-tight flex items-center gap-2"
      >
        <i class="fa-solid fa-industry"></i> Production Lifecycle
      </h2>
      <p class="text-gray-600 mt-1">
        Track the journey of each product through production.
      </p>
    </div>

    <div class="flex gap-3" *ngIf="scheduledProducts.length > 0">
      <button
        (click)="exportXLS()"
        class="px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition flex items-center gap-2"
      >
        <i class="fa-solid fa-file-excel"></i> Export XLS
      </button>

      <button
        (click)="exportPDF()"
        class="px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition flex items-center gap-2"
      >
        <i class="fa-solid fa-file-pdf"></i> Export PDF
      </button>

      <button
        (click)="downloadEfficiencyReport()"
        class="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700 transition flex items-center gap-2"
      >
        <i class="fa-solid fa-chart-line"></i> Efficiency Report
      </button>
    </div>
  </div>

  <!-- Chart Section -->
  <div *ngIf="!loading && scheduledProducts.length > 0" class="mb-8">
    <h3
      class="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2"
    >
      <i class="fa-solid fa-chart-pie"></i> Status Overview
    </h3>

    <div
      class="flex justify-center p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-200"
    >
      <div class="w-72 h-72">
        <canvas
          baseChart
          [data]="statusChartData"
          [options]="statusChartOptions"
          [type]="'doughnut'"
        ></canvas>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div
    *ngIf="loading"
    class="text-center text-blue-700 p-6 text-lg font-semibold flex justify-center gap-2"
  >
    <i class="fa-solid fa-spinner fa-spin"></i> Loading...
  </div>

  <!-- No Data -->
  <div
    *ngIf="!loading && scheduledProducts.length === 0"
    class="text-center p-10 text-gray-500 text-lg font-medium bg-gray-50 rounded-xl border flex justify-center items-center gap-2"
  >
    <i class="fa-solid fa-ban text-red-500"></i> No schedules found.
  </div>

  <!-- Table -->
  <div *ngIf="scheduledProducts.length > 0" class="overflow-x-auto">
    <div class="rounded-2xl border border-gray-200 shadow-xl overflow-hidden">
      <table class="min-w-full bg-white">
        <thead
          class="bg-gradient-to-r from-blue-700 to-blue-500 text-white shadow"
        >
          <tr>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              ID
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              Product
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              Qty
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              Start
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              End
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              Deadline
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              Progress
            </th>
            <th class="p-4 text-left text-sm font-semibold tracking-wide">
              Status
            </th>
            <th class="p-4 text-center text-sm font-semibold tracking-wide">
              Action
            </th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let sp of scheduledProducts"
            class="odd:bg-gray-50 even:bg-white transition hover:bg-blue-50/70"
          >
            <td class="p-4 text-gray-800 font-semibold">#{{ sp.psId }}</td>

            <td class="p-4 text-gray-700">
              {{ sp.psProductId?.productName }}
            </td>

            <td class="p-4 text-gray-700">{{ sp.psQuantity }}</td>

            <td class="p-4 text-gray-600">{{ sp.psStartDate }}</td>
            <td class="p-4 text-gray-600">{{ sp.psEndDate }}</td>

            <td class="p-4 text-gray-700 font-medium">
              {{ sp.psDeadline || "Order scheduled ages back" }}
            </td>

            <!-- Progress -->
            <td class="p-4 w-40">
              <div class="flex flex-col">
                <div
                  class="h-3 w-full bg-gray-200 rounded-full overflow-hidden"
                >
                  <div
                    class="h-full bg-green-500 rounded-full transition-all duration-500"
                    [style.width.%]="
                      ((sp.completedQuantity ?? 0) / (sp.psQuantity ?? 1)) * 100
                    "
                  ></div>
                </div>
                <span class="mt-1 text-xs text-gray-600">
                  {{ sp.completedQuantity }}/{{ sp.psQuantity }}
                </span>
              </div>
            </td>

            <!-- Status -->
            <td class="p-4">
              <span
                class="px-3 py-1 text-sm rounded-full font-medium shadow-sm"
                [ngClass]="{
                  'bg-yellow-100 text-yellow-700': sp.psStatus === 'SCHEDULED',
                  'bg-blue-100 text-blue-700': sp.psStatus === 'IN_PROGRESS',
                  'bg-orange-100 text-orange-700':
                    sp.psStatus === 'QUALITY_CHECK',
                  'bg-green-100 text-green-700': sp.psStatus === 'READY',
                  'bg-purple-100 text-purple-700': sp.psStatus === 'DISPATCHED'
                }"
              >
                <i
                  class="fa-solid"
                  [ngClass]="{
                    'fa-clock': sp.psStatus === 'SCHEDULED',
                    'fa-spinner fa-spin': sp.psStatus === 'IN_PROGRESS',
                    'fa-magnifying-glass': sp.psStatus === 'QUALITY_CHECK',
                    'fa-check-circle': sp.psStatus === 'READY',
                    'fa-truck-fast': sp.psStatus === 'DISPATCHED'
                  }"
                ></i>
                {{ sp.psStatus }}
              </span>
            </td>

            <!-- Action -->
            <td class="p-4 text-center">
              <ng-container *ngIf="sp.psStatus === 'READY'; else notReady">
                <button
                  (click)="dispatch(sp.psId)"
                  class="px-4 py-1 bg-purple-600 text-white rounded-lg shadow hover:bg-purple-700 transition disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2"
                  [disabled]="sp.completedQuantity !== sp.psQuantity"
                >
                  <i class="fa-solid fa-truck"></i> Dispatch
                </button>
              </ng-container>

              <ng-template #notReady>
                <span
                  *ngIf="
                    sp.psStatus === 'DISPATCHED' || sp.psStatus === 'DELIVERED'
                  "
                  class="text-green-600 font-semibold flex items-center gap-1"
                >
                  <i class="fa-solid fa-circle-check"></i> Dispatched
                </span>

                <span
                  *ngIf="
                    sp.psStatus !== 'DISPATCHED' && sp.psStatus !== 'DELIVERED'
                  "
                  class="text-gray-500 italic flex items-center gap-1"
                >
                  <i class="fa-solid fa-hourglass-half"></i> In progress...
                </span>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
